MODULE PLOT

	USE PATCH_MAPPING
	USE GEOMETRY
	USE GSQUAD

	implicit integer (i-n)
	implicit real(8) (a-h,o-z)

CONTAINS

SUBROUTINE PLOTGM()
	
	TYPE(RECPATCH) :: IRBOX
	TYPE(TRANSFORM2D) :: GSPT
	TYPE(POINT2D) :: TSPT, PHY_PT, NURBS_TSPT
 	TYPE(FUNCTION_1D) :: TS_BS
	TYPE(FUNCTION_2D) :: DF_NURBS(2)
	TYPE(DIFF_BSPLINES) :: TS_NURBS
	REAL*8 :: NURBS_SUM(2)
	INTEGER :: I, J, II, JJ, KK, NI, NJ, NM

	OPEN(1, FILE='./data/irbox1')
	OPEN(2, FILE='./data/phyirbox1')
	DO JJ=1, NUMIR(1,2)-1
		DO II=1, NUMIR(1,1)-1
			IRBOX%PT1 = POINT2D(IR_GRID(1,1,II), IR_GRID(1,2,JJ))
			IRBOX%PT2 = POINT2D(IR_GRID(1,1,II+1), IR_GRID(1,2,JJ))
			IRBOX%PT3 = POINT2D(IR_GRID(1,1,II+1), IR_GRID(1,2,JJ+1))
			IRBOX%PT4 = POINT2D(IR_GRID(1,1,II), IR_GRID(1,2,JJ+1))
			WRITE(1, *) IRBOX%PT1
			WRITE(1, *) IRBOX%PT2
			WRITE(1, *) IRBOX%PT3
			WRITE(1, *) IRBOX%PT4
			WRITE(1, *) IRBOX%PT1
			WRITE(1,*)
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT1,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT2,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT3,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT4,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT1,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(2,*)
		ENDDO
	ENDDO
	CLOSE(1)
	CLOSE(2)
	
	OPEN(1, FILE='./data/irbox2')
	OPEN(2, FILE='./data/phyirbox2')
	DO JJ=1, NUMIR(2,2)-1
		DO II=1, NUMIR(2,1)-1
			IRBOX%PT1 = POINT2D(IR_GRID(2,1,II), IR_GRID(2,2,JJ))
			IRBOX%PT2 = POINT2D(IR_GRID(2,1,II+1), IR_GRID(2,2,JJ))
			IRBOX%PT3 = POINT2D(IR_GRID(2,1,II+1), IR_GRID(2,2,JJ+1))
			IRBOX%PT4 = POINT2D(IR_GRID(2,1,II), IR_GRID(2,2,JJ+1))
			WRITE(1, *) IRBOX%PT1
			WRITE(1, *) IRBOX%PT2
			WRITE(1, *) IRBOX%PT3
			WRITE(1, *) IRBOX%PT4
			WRITE(1, *) IRBOX%PT1
			WRITE(1,*)
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT1,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT2,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT3,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT4,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(2, *) GET_POINT_NURVE_SURFACE_2D(IRBOX%PT1,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(2,*)
		ENDDO
	ENDDO
	CLOSE(1)
	CLOSE(2)
	
	OPEN(1, FILE = './data/ndx')
	DO I=1, DOF
		WRITE(1,*) NDX(:,I)
	ENDDO
	CLOSE(1)
	
	OPEN(1, FILE = './data/bdndx')
	DO J = 1, NUM_PATCH
		DO I=1, BDNDX(J,1)%LC_NUM
			WRITE(1,*) J, BDNDX(J,I)%LC_NDX(:), BDNDX(J,I)%LC_NUM, BDNDX(J,I)%GL_NDX
		ENDDO
	ENDDO
	CLOSE(1)
	
	OPEN(1, FILE='./data/basis_knot1')
	WRITE(1,*) 'POLY_ORDER : ', BASIS_KVEC(1,1)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', BASIS_KVEC(1,1)%LENGTH
	DO I=0, BASIS_KVEC(1,1)%LENGTH
		WRITE(1,102) BASIS_KVEC(1,1)%KNOTS(I)
	ENDDO
	WRITE(1,*)
	WRITE(1,*) 'POLY_ORDER : ', BASIS_KVEC(1,2)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', BASIS_KVEC(1,2)%LENGTH
	DO I=0, BASIS_KVEC(1,2)%LENGTH
		WRITE(1,102) BASIS_KVEC(1,2)%KNOTS(I)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE='./data/basis_knot2')
	WRITE(1,*) 'POLY_ORDER : ', BASIS_KVEC(2,1)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', BASIS_KVEC(2,1)%LENGTH
	DO I=0, BASIS_KVEC(2,1)%LENGTH
		WRITE(1,102) BASIS_KVEC(2,1)%KNOTS(I)
	ENDDO
	WRITE(1,*)
	WRITE(1,*) 'POLY_ORDER : ', BASIS_KVEC(2,2)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', BASIS_KVEC(2,2)%LENGTH
	DO I=0, BASIS_KVEC(2,2)%LENGTH
		WRITE(1,102) BASIS_KVEC(2,2)%KNOTS(I)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE='./data/geo_basis_knot1')
	WRITE(1,*) 'POLY_ORDER : ', GEO_KVEC(1,1)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', GEO_KVEC(1,1)%LENGTH
	DO I=0, GEO_KVEC(1,1)%LENGTH
		WRITE(1,102) GEO_KVEC(1,1)%KNOTS(I)
	ENDDO
	WRITE(1,*)
	WRITE(1,*) 'POLY_ORDER : ', GEO_KVEC(1,2)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', GEO_KVEC(1,2)%LENGTH
	DO I=0, GEO_KVEC(1,2)%LENGTH
		WRITE(1,102) GEO_KVEC(1,2)%KNOTS(I)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE='./data/geo_basis_knot2')
	WRITE(1,*) 'POLY_ORDER : ', GEO_KVEC(2,1)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', GEO_KVEC(2,1)%LENGTH
	DO I=0, GEO_KVEC(2,1)%LENGTH
		WRITE(1,102) GEO_KVEC(2,1)%KNOTS(I)
	ENDDO
	WRITE(1,*)
	WRITE(1,*) 'POLY_ORDER : ', GEO_KVEC(2,2)%POLY_ORDER
	WRITE(1,*) 'LENGTH : ', GEO_KVEC(2,2)%LENGTH
	DO I=0, GEO_KVEC(2,2)%LENGTH
		WRITE(1,102) GEO_KVEC(2,2)%KNOTS(I)
	ENDDO
	CLOSE(1)

	OPEN(11, FILE = './data/ctl1')
	DO I=0, NUMBS(1,2)-1
		DO J=0, NUMBS(1,1)-1
			WRITE(11,*) GEO_CTL(1)%PTS(J,I,0), GEO_CTL(1)%WGTS(J,I,0)
		ENDDO
		WRITE(11,*)
	ENDDO
	DO J=0, NUMBS(1,1)-1
		DO I=0, NUMBS(1,2)-1
			WRITE(11,*) GEO_CTL(1)%PTS(J,I,0), GEO_CTL(1)%WGTS(J,I,0)
		ENDDO
		WRITE(11,*)
	ENDDO
	CLOSE(11)

	OPEN(11, FILE = './data/ctl2')
	DO I=0, NUMBS(2,2)-1
		DO J=0, NUMBS(2,1)-1
			WRITE(11,*) GEO_CTL(2)%PTS(J,I,0), GEO_CTL(2)%WGTS(J,I,0)
		ENDDO
		WRITE(11,*)
	ENDDO
	DO J=0, NUMBS(2,1)-1
		DO I=0, NUMBS(2,2)-1
			WRITE(11,*) GEO_CTL(2)%PTS(J,I,0), GEO_CTL(2)%WGTS(J,I,0)
		ENDDO
		WRITE(11,*)
	ENDDO
	CLOSE(11)

	OPEN(1, FILE = './data/bsplinex1')
	DO J=0, NUMBS(1,1)-1
		DO I=1, 601
			TSPT%X = 1.D0*(I-1)/600.D0
			TS_BS = GET_DIFF_BSPLINE(TSPT%X,BASIS_KVEC(1,1),J,2)
			WRITE(1,*) TSPT%X, TS_BS%VAL(:)
		ENDDO
		WRITE(1,*)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE = './data/bsplinex2')
	DO J=0, NUMBS(2,1)-1
		DO I=1, 601
			TSPT%X = 1.D0*(I-1)/600.D0
			TS_BS = GET_DIFF_BSPLINE(TSPT%X,BASIS_KVEC(2,1),J,2)
			WRITE(1,*) TSPT%X, TS_BS%VAL(:)
		ENDDO
		WRITE(1,*)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE = './data/bspliney1')
	DO J=0, NUMBS(1,2)-1
		DO I=1, 601
			TSPT%Y = 1.D0*(I-1)/600.D0
			TS_BS = GET_DIFF_BSPLINE(TSPT%Y,BASIS_KVEC(1,2),J,2)
			WRITE(1,*) TSPT%Y, TS_BS%VAL(:)
		ENDDO
		WRITE(1,*)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE = './data/bspliney2')
	DO J=0, NUMBS(2,2)-1
		DO I=1, 601
			TSPT%Y = 1.D0*(I-1)/600.D0
			TS_BS = GET_DIFF_BSPLINE(TSPT%Y,BASIS_KVEC(2,2),J,2)
			WRITE(1,*) TSPT%Y, TS_BS%VAL(:)
		ENDDO
		WRITE(1,*)
	ENDDO
	CLOSE(1)

	OPEN(1, FILE = './data/geometry1')
	DO I=1, 101
 		DO J=1, 101
 			TSPT%Y = 1.D0*(I-1)/100.D0
			TSPT%X = 1.D0*(J-1)/100.D0
			PHY_PT = GET_POINT_NURVE_SURFACE_2D(TSPT,GEO_KVEC(1,:),GEO_CTL(1))
			WRITE(1,*) PHY_PT
		ENDDO
		WRITE(1,*) 
	ENDDO
	CLOSE(1)

	OPEN(1, FILE = './data/geometry2')
! 	OPEN(2, FILE = './data/parameter2')
	DO I=1, 101
 		DO J=1, 101
 			TSPT%Y = 1.D0*(I-1)/100.D0
			TSPT%X = 1.D0*(J-1)/100.D0
			PHY_PT = GET_POINT_NURVE_SURFACE_2D(TSPT,GEO_KVEC(2,:),GEO_CTL(2))
			WRITE(1,*) PHY_PT
! 			CALL GET_DIFF_EXOTIC_GEO_MAP(DF_NURBS,TSPT,GEO_KVEC(2,:),GEO_CTL(2),1)
! 			WRITE(1,*) DF_NURBS(1)%VAL(0,0), DF_NURBS(2)%VAL(0,0)
! 			TSPT = GET_REF_PT(PHY_PT,2)
! 			WRITE(2,*) TSPT
! 			PRINT*, PHY_PT, TSPT
		ENDDO
		WRITE(1,*) 
! 		WRITE(2,*)
	ENDDO
	CLOSE(1)
! 	CLOSE(2)

! 	PRINT*, 'PLOT - HERE0'

! 	OPEN(1, FILE = './data/FtoG')
! 	DO I = 1, 101
!  		DO J = 1, 101
!  			TSPT%Y = 1.D0*(I-1)/100.D0
! 			TSPT%X = 1.D0*(J-1)/100.D0
! 			PHY_PT = GET_PHY_PT(TSPT, 2)
! 			TSPT = GET_REF_PT(PHY_PT,1)
! ! 			PRINT*, 'f2f1-',I,J
! 			WRITE(1,*) TSPT
! 		ENDDO
! 		WRITE(1,*) 
! 	ENDDO
! 	CLOSE(1)

! 	OPEN(1, FILE = './data/GtoF')
! 	DO I = 2, 100
!  		DO J = 2, 100
!  			TSPT%Y = 1.D0*(I-1)/100.D0
! 			TSPT%X = 1.D0*(J-1)/100.D0
! 			PHY_PT = GET_PHY_PT(TSPT, 1)
! 			IF (DSQRT(PHY_PT%X**2 + PHY_PT%Y**2).LE.0.6D0) THEN
! 				TSPT = GET_REF_PT(PHY_PT,2)
! ! 			PRINT*, 'f2f1-',I,J
! 				WRITE(1,*) TSPT
! 			ENDIF
! 		ENDDO
! 		WRITE(1,*) 
! 	ENDDO
! 	CLOSE(1)

! 	PRINT*, 'PLOT - HERE1'

! 	OPEN(1, FILE = './data/test_nurbs_ft')
! 	DO I=1, 101
! 		NURBS_SUM = 0.D0
!  		TSPT%Y = 1.D0*(I-1)/100.D0
! 		TS_NURBS = GET_ALL_DIFF_NURBS_CURVE_2D(TSPT%Y,TEST_KVEC,TEST_CTL,1)
! 		PHY_PT = GET_POINT_NURVE_CURVE_2D(TSPT%Y,TEST_KVEC,TEST_CTL)
! 		WRITE(1,*) PHY_PT, tspt%y, TS_NURBS%N(2,0)
! 		DO J = 0, 2
! 			NURBS_SUM(1) = NURBS_SUM(1) + TS_NURBS%N(J,0)
! 			NURBS_SUM(2) = NURBS_SUM(2) + TS_NURBS%N(J,1)
! 		ENDDO
! ! 		PRINT*, NURBS_SUM
! 	ENDDO
! 	CLOSE(1)

	
	OPEN(1, FILE = './data/nurbs_bd1')
	DO J=1, 201
		TSPT = POINT2D(1.D0*(J-1)/200.D0, 0.D0)
		PHY_PT = GET_PHY_PT(TSPT,1)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(1.D0, 1.D0*(J-1)/200.D0)
		PHY_PT = GET_PHY_PT(TSPT,1)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(1.D0*(J-1)/200.D0, 1.D0)
		PHY_PT = GET_PHY_PT(TSPT,1)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(0.D0, 1.D0*(J-1)/200.D0)
		PHY_PT = GET_PHY_PT(TSPT,1)
		WRITE(1,*) PHY_PT
	ENDDO
	CLOSE(1)
	
OPEN(1, FILE = './data/nurbs_bd2')
	DO J=1, 201
		TSPT = POINT2D(1.D0*(J-1)/200.D0, 0.D0)
		PHY_PT = GET_PHY_PT(TSPT,2)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(1.D0, 1.D0*(J-1)/200.D0)
		PHY_PT = GET_PHY_PT(TSPT,2)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(1.D0*(J-1)/200.D0, 1.D0)
		PHY_PT = GET_PHY_PT(TSPT,2)
		WRITE(1,*) PHY_PT
	ENDDO
	WRITE(1,*)
	DO J=1, 201
		TSPT = POINT2D(0.D0, 1.D0*(J-1)/200.D0)
		PHY_PT = GET_PHY_PT(TSPT,2)
		WRITE(1,*) PHY_PT
	ENDDO
	CLOSE(1)

	WRITE(*,*)
	WRITE(*,*) '<<< PLOT DATA AND RECORD INFORMATION : DONE >>>'
	WRITE(*,*)

	102 FORMAT(1000(f20.8,1x))
END SUBROUTINE PLOTGM

END MODULE PLOT
